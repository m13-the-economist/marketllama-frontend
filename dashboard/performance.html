<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Performance — Market Llama</title>
  <meta name="description" content="Performance analytics for your trading accounts." />

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">

  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="30" fill="%234169E1"/><path d="M20 34h24v6H20zM20 24h18v6H20z" fill="white"/></svg>' />

  <link rel="stylesheet" href="./components/navbar.css" />

  <style>
    :root {
      --header-h: 60px;
      --bg: #0b0b0c;
      --panel: #121214;
      --muted: #8f8f92;
      --text: #ffffff;
      --accent: #ffffff;
      --accent-plain: #dadada;
      --glow: rgba(255, 255, 255, .06);
      --glass: rgba(255, 255, 255, .04);
      --ring: rgba(255, 255, 255, .12);
      --pill: #16171a;
      --shadow: 0 18px 40px rgba(0, 0, 0, .6);
      --green: #30c977;
      --red: #ff4d6a;
      --amber: #e6a23c;
      --nav-teal: #1a6d72;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 14px; }

    body.app.dark {
      background: var(--bg);
      color: var(--text);
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Layout */
    .dashboard { min-height: 100vh; padding-top: var(--header-h); }

    .content {
      margin-left: 260px;
      padding: 24px clamp(16px, 3vw, 32px);
      transition: margin-left 0.25s ease;
    }
    .side[data-state="collapsed"] ~ .content { margin-left: 84px; }

    .backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .45);
      z-index: 35;
      backdrop-filter: blur(2px);
    }
    .backdrop[hidden] { display: none; }

    /* Video background */
    .video-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: -1; }
    .video-background video { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }

    /* PERFORMANCE SHELL */
    .perf-shell {
      max-width: 1480px;
      margin: 8px auto 40px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .045), rgba(255, 255, 255, .025));
      border-radius: 28px;
      border: 1px solid var(--ring);
      padding: 32px 32px 40px;
      box-shadow: var(--shadow);
    }

    .perf-head { display: flex; align-items: flex-start; justify-content: space-between; gap: 18px; margin-bottom: 28px; }
    .perf-title { font-size: clamp(24px, 3vw, 34px); font-weight: 800; letter-spacing: .3px; margin-bottom: 6px; }
    .perf-sub { max-width: 520px; font-size: 12px; color: var(--muted); line-height: 1.6; }
    .perf-chip { align-self: flex-start; padding: 6px 12px; border-radius: 999px; border: 1px solid var(--ring); font-size: 11px; text-transform: uppercase; letter-spacing: .14em; color: var(--accent-plain); background: rgba(0, 0, 0, 0.4); }

    .section-label { font-size: 11px; text-transform: uppercase; letter-spacing: .18em; color: var(--accent-plain); margin-bottom: 12px; }

    /* KPI ROW */
    .kpi-row { display: grid; grid-template-columns: repeat(5, minmax(0, 1fr)); gap: 18px; margin-bottom: 32px; }
    .kpi-card { position: relative; background: radial-gradient(circle at top left, rgba(255,255,255,.06), rgba(255,255,255,.02)); border-radius: 22px; border: 1px solid var(--ring); padding: 22px 22px 26px; min-height: 150px; box-shadow: 0 16px 40px rgba(0,0,0,.75); }
    .kpi-label { font-size: 11px; text-transform: uppercase; letter-spacing: .14em; color: var(--accent-plain); margin-bottom: 10px; }
    .kpi-value { font-size: 26px; font-weight: 800; margin-bottom: 4px; }
    .kpi-sub { font-size: 11px; color: var(--muted); }

    /* WEEKLY + CALENDAR */
    .mid-row { display: grid; grid-template-columns: minmax(0, 1.25fr) minmax(0, 1.9fr); gap: 28px; margin-bottom: 32px; margin-top: 8px; }
    .panel { background: rgba(0, 0, 0, 0.55); border-radius: 22px; border: 1px solid var(--ring); padding: 20px 20px 18px; box-shadow: 0 14px 30px rgba(0,0,0,.7); min-height: 260px; }
    .panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .panel-title { font-size: 13px; text-transform: uppercase; letter-spacing: .16em; color: var(--accent-plain); }
    .panel-meta { font-size: 11px; color: var(--muted); }

    .week-list { display: flex; flex-direction: column; gap: 10px; margin-top: 4px; }
    .week-card { border-radius: 18px; border: 1px solid rgba(255,255,255,.08); background: linear-gradient(90deg, rgba(255,255,255,.04), rgba(255,255,255,.01)); padding: 16px 16px 14px; min-height: 96px; display: flex; flex-direction: column; justify-content: center; }
    .week-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px; font-size: 12px; }
    .week-name { font-weight: 600; }
    .week-range { color: var(--muted); font-size: 11px; }
    .week-bottom { display: flex; align-items: center; justify-content: space-between; font-size: 11px; }
    .week-pnl { font-weight: 600; }
    .week-pnl.green { color: var(--green); }
    .week-pnl.red { color: var(--red); }
    .week-days { color: var(--muted); }

    /* Calendar */
    .calendar-controls { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
    .calendar-main-label { font-size: 12px; font-weight: 600; }

    .calendar-btn {
      background: rgba(0,0,0,.6);
      border-radius: 999px;
      border: 1px solid var(--ring);
      padding: 4px 8px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      font-size: 11px;
      color: var(--accent-plain);
    }

    .calendar-select {
      background: #101014;
      border: 1px solid var(--ring);
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      color: var(--accent-plain);
      outline: none;
    }

    .calendar-legend { margin-left: auto; font-size: 11px; color: var(--muted); }
    .calendar-legend span { margin-left: 10px; }
    .legend-dot { display: inline-block; width: 10px; height: 10px; border-radius: 3px; margin-right: 4px; }
    .dot-green { background: rgba(48, 201, 119, 0.85); }
    .dot-red { background: rgba(255, 77, 106, 0.9); }
    .dot-gray { background: rgba(120, 120, 120, 0.7); }

    .calendar-grid { margin-top: 10px; }
    .calendar-weekdays { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); font-size: 11px; color: var(--muted); text-align: center; margin-bottom: 4px; }
    .calendar-weekdays div { padding: 4px 0; }
    .calendar-days { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); gap: 6px; }

    .day-cell {
      border-radius: 14px;
      min-height: 74px;
      padding: 6px 6px 6px;
      border: 1px solid rgba(255,255,255,.06);
      background: rgba(10,10,12,.8);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      font-size: 11px;
    }
    .day-empty { opacity: .35; background: transparent; border-style: dashed; }
    .day-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
    .day-num { font-weight: 600; font-size: 11px; }
    .day-trades { color: var(--muted); font-size: 10px; }
    .day-pnl { font-size: 10px; margin-top: 4px; }

    .day-positive { background: rgba(48, 201, 119, 0.18); border-color: rgba(48, 201, 119, 0.4); }
    .day-positive .day-pnl { color: var(--green); }

    .day-negative { background: rgba(255, 77, 106, 0.16); border-color: rgba(255, 77, 106, 0.45); }
    .day-negative .day-pnl { color: var(--red); }

    .day-neutral { background: rgba(120, 120, 120, 0.16); border-color: rgba(140, 140, 140, 0.35); }

    /* CHART CLUSTER */
    .chart-cluster { margin-bottom: 32px; background: rgba(0, 0, 0, 0.6); border-radius: 22px; border: 1px solid var(--ring); padding: 20px 20px 18px; box-shadow: 0 14px 32px rgba(0,0,0,.7); }
    .chart-cluster-header { display: flex; flex-direction: column; gap: 4px; margin-bottom: 14px; }
    .chart-cluster-title { font-size: 12px; text-transform: uppercase; letter-spacing: .16em; color: var(--accent-plain); }
    .chart-cluster-sub { font-size: 11px; color: var(--muted); }
    .chart-cluster-grid { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 16px; align-items: stretch; }

    .chart-card { background: rgba(0, 0, 0, 0.4); border-radius: 18px; border: 1px solid rgba(255,255,255,.08); padding: 14px 14px 12px; min-height: 190px; display: flex; flex-direction: column; }
    .chart-title { font-size: 11px; text-transform: uppercase; letter-spacing: .16em; color: var(--accent-plain); margin-bottom: 4px; }
    .chart-sub { font-size: 10px; color: var(--muted); margin-bottom: 6px; }
    .chart-wrapper { flex: 1; position: relative; height: 130px; }

    /* History table */
    .history-shell { background: rgba(0, 0, 0, 0.6); border-radius: 22px; border: 1px solid var(--ring); padding: 20px 20px 16px; box-shadow: 0 16px 36px rgba(0,0,0,.75); }
    .history-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .history-title { font-size: 12px; text-transform: uppercase; letter-spacing: .16em; color: var(--accent-plain); }
    .history-meta { font-size: 11px; color: var(--muted); }

    .table-scroll { max-height: 360px; overflow: auto; border-radius: 14px; border: 1px solid rgba(255,255,255,.05); }
    table { width: 100%; border-collapse: collapse; font-size: 11px; }
    thead { position: sticky; top: 0; background: #101014; z-index: 1; }
    th, td { padding: 8px 10px; white-space: nowrap; text-align: left; }
    th { font-weight: 500; color: var(--muted); border-bottom: 1px solid rgba(255,255,255,.08); background: #101014; }
    tbody tr:nth-child(even) { background: rgba(255,255,255,.02); }
    tbody tr:hover { background: rgba(255,255,255,.06); }

    .badge-type { display: inline-flex; align-items: center; justify-content: center; padding: 2px 8px; border-radius: 999px; font-size: 10px; font-weight: 500; }
    .badge-buy { background: rgba(48, 201, 119, 0.16); color: var(--green); }
    .badge-sell { background: rgba(255, 77, 106, 0.16); color: var(--red); }
    .pnl-pos { color: var(--green); }
    .pnl-neg { color: var(--red); }
    .share-icon { cursor: pointer; opacity: .8; }
    .share-icon:hover { opacity: 1; }

    /* Legal footer */
    .legal-footer {
      margin-left: 260px;
      margin-top: 24px;
      padding: 18px clamp(16px, 3vw, 32px);
      border-top: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--muted);
      font-size: 13px;
    }
    .side[data-state="collapsed"] ~ .legal-footer { margin-left: 84px; }

    .footer-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: flex-start; gap: 24px; }
    .footer-risk { line-height: 1.7; max-width: 720px; }
    .footer-links { text-align: right; font-size: 13px; }
    .footer-links-list { list-style: none; display: flex; flex-direction: column; gap: 4px; }
    .footer-links a { color: var(--accent-plain); text-decoration: none; opacity: 0.9; transition: opacity 0.2s ease, text-decoration-color 0.2s ease; }
    .footer-links a:hover { opacity: 1; text-decoration: underline; }

    /* Chat */
    .chat-fab {
      position: fixed;
      right: 20px;
      bottom: 88px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--nav-teal);
      color: #eaeaea;
      border: 1px solid rgba(255, 255, 255, .18);
      cursor: pointer;
      z-index: 1100;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(0, 0, 0, .45);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      backdrop-filter: blur(8px);
    }
    .chat-fab:hover { transform: translateY(-1px); box-shadow: 0 14px 30px rgba(0, 0, 0, .5); background: #20848a; }
    .chat-fab svg { width: 24px; height: 24px; stroke: currentColor; }

    .chat-panel {
      position: fixed;
      right: 20px;
      bottom: 156px;
      width: min(420px, 92vw);
      max-height: 72vh;
      background: rgba(8, 20, 24, .96);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(26, 109, 114, 0.6);
      border-radius: 16px;
      z-index: 1200;
      display: flex;
      flex-direction: column;
      opacity: 0;
      transform: translateY(8px) scale(.98);
      pointer-events: none;
      transition: opacity .2s ease, transform .2s ease;
      color: #fff;
      overflow: hidden;
    }
    .chat-panel.open { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }

    .chat-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 14px; border-bottom: 1px solid rgba(255, 255, 255, .06); background: var(--nav-teal); }
    .chat-title { font-weight: 600; }
    .chat-close { background: none; border: none; color: #fff; font-size: 22px; cursor: pointer; line-height: 1; }
    .chat-body { padding: 12px; display: flex; flex-direction: column; gap: 8px; overflow: auto; }
    .chat-msg { font-size: .92rem; line-height: 1.4; background: rgba(255, 255, 255, .06); color: #eaeaea; padding: 8px 10px; border-radius: 12px; max-width: 85%; }
    .chat-msg.bot { align-self: flex-start; }
    .chat-msg.user { align-self: flex-end; background: var(--nav-teal); color: #fff; }

    .chat-input-row { display: flex; gap: 8px; padding: 12px; border-top: 1px solid rgba(255, 255, 255, .06); background: rgba(6, 14, 16, 0.96); }
    .chat-input-row input { flex: 1; background: rgba(255, 255, 255, .06); border: 1px solid rgba(255, 255, 255, .12); color: #fff; border-radius: 12px; padding: 10px 12px; }
    .chat-send { background: var(--nav-teal); color: #fff; border: none; border-radius: 12px; padding: 10px 14px; cursor: pointer; }

    /* Responsive */
    @media (max-width: 1100px) {
      .desktop-only { display: none; }
      .mobile-only { display: inline-flex; }
      .kpi-row { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .chart-cluster-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @media (max-width: 1024px) {
      .side[data-state="expanded"] { width: 200px; }
      .content { margin-left: 200px; }
      .legal-footer { margin-left: 200px; }
    }

    @media (max-width: 900px) {
      .mid-row { grid-template-columns: minmax(0, 1fr); }
      .chart-cluster-grid { grid-template-columns: minmax(0, 1fr); }
    }

    @media (max-width: 768px) {
      :root { --header-h: 56px; }

      .side { left: -240px; width: 240px; }
      .side.open { left: 0; }
      .content { margin-left: 0; padding-inline: 12px; }

      .language-dropdown { right: 10px; min-width: 140px; }

      .perf-shell { padding: 20px 14px 26px; }

      .kpi-row { grid-template-columns: minmax(0, 1fr); gap: 12px; }
      .kpi-card { padding: 14px 14px 16px; min-height: 110px; border-radius: 18px; }
      .kpi-label { font-size: 10px; letter-spacing: .12em; margin-bottom: 6px; }
      .kpi-value { font-size: 20px; margin-bottom: 2px; }
      .kpi-sub { font-size: 10px; }

      .perf-head { flex-direction: column; align-items: flex-start; gap: 10px; }

      .legal-footer { margin-left: 0; padding-inline: 12px; }
      .footer-inner { flex-direction: column; align-items: flex-start; gap: 12px; }
      .footer-links { text-align: left; }

      .site-header { padding: 6px 10px; gap: 6px; }
      .site-actions { gap: 6px; }
      .icon-btn { padding: 4px 6px; border-radius: 8px; border: none; background: transparent; }

      /* HIDE QR, BALANCE + EYE ONLY ON MOBILE */
      #qrBtn { display: none; }
      .balance-wrap { display: none !important; }

      .ic { font-size: 16px; }

      .footer-risk strong { display: block; text-align: center; margin-bottom: 8px; }
    }

    @media (min-width: 769px) {
      .content { margin-left: 260px; }
    }

    @media (max-width:540px) {
      .chat-fab { right: 14px; bottom: 88px; }
      .chat-panel { right: 14px; bottom: 148px; }
    }
  </style>
</head>

<body class="app dark">
  <div class="video-background"></div>

  <!-- ===== NAVBAR COMPONENT ===== -->
  <div id="ml-navbar"></div>

  <!-- ===== BACKDROP FOR MOBILE MENU ===== -->
  <div class="backdrop" id="backdrop" hidden></div>

  <main class="dashboard">
    <section class="content" id="content">
      <div class="perf-shell">
        <div class="perf-head">
          <div>
            <h1 class="perf-title" data-i18n="performance">Performance</h1>
            <p class="perf-sub">
              High-level performance KPIs for your linked trading accounts. Data updates in real-time.
            </p>
          </div>
          <div class="perf-chip" data-i18n="last30Days">Last 30 Days</div>
        </div>

        <div class="section-label" data-i18n="kpiSection">Key Performance Indicators</div>
        <div class="kpi-row">
          <div class="kpi-card">
            <div class="kpi-label" data-i18n="kpiTradingDays">Trading Days</div>
            <div class="kpi-value" id="kpiDays">—</div>
            <div class="kpi-sub" data-i18n="kpiUpdatedDaily">Updated daily.</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label" data-i18n="kpiTotalTrades">Total Trades Taken</div>
            <div class="kpi-value" id="kpiTrades">—</div>
            <div class="kpi-sub" data-i18n="kpiAllClosed">All closed positions.</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label" data-i18n="kpiTotalLots">Total Lots Used</div>
            <div class="kpi-value" id="kpiLots">—</div>
            <div class="kpi-sub" data-i18n="kpiCombinedExposure">Combined exposure across trades.</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label" data-i18n="kpiBiggestWin">Biggest Win</div>
            <div class="kpi-value" id="kpiWin">—</div>
            <div class="kpi-sub" data-i18n="kpiBestTrade">Single best trade in the period.</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-label" data-i18n="kpiBiggestLoss">Biggest Loss</div>
            <div class="kpi-value" id="kpiLoss">—</div>
            <div class="kpi-sub" data-i18n="kpiLargestDrawdown">Largest drawdown on a trade.</div>
          </div>
        </div>

        <div class="mid-row">
          <div class="panel">
            <div class="panel-header">
              <div class="panel-title" data-i18n="weeklySummary">Weekly Summary</div>
            </div>
            <div class="week-list" id="weekList"></div>
          </div>

          <div class="panel">
            <div class="panel-header">
              <div class="panel-title" data-i18n="dailyPnlCalendar">Daily PnL Calendar</div>
            </div>

            <div class="calendar-controls">
              <button class="calendar-btn" id="prevMonthBtn">
                <iconify-icon icon="mdi:chevron-left"></iconify-icon>
              </button>
              <div class="calendar-main-label" id="calendarLabel"></div>
              <button class="calendar-btn" id="nextMonthBtn">
                <iconify-icon icon="mdi:chevron-right"></iconify-icon>
              </button>

              <select class="calendar-select" id="monthSelect"></select>
              <select class="calendar-select" id="yearSelect"></select>

              <div class="calendar-legend">
                <span data-i18n="legendGreen"><span class="legend-dot dot-green"></span>Green = profit</span>
                <span data-i18n="legendRed"><span class="legend-dot dot-red"></span>Red = loss</span>
                <span data-i18n="legendNone"><span class="legend-dot dot-gray"></span>No trades</span>
              </div>
            </div>

            <div class="calendar-grid">
              <div class="calendar-weekdays">
                <div data-i18n="mon">Mon</div>
                <div data-i18n="tue">Tue</div>
                <div data-i18n="wed">Wed</div>
                <div data-i18n="thu">Thu</div>
                <div data-i18n="fri">Fri</div>
                <div data-i18n="sat">Sat</div>
                <div data-i18n="sun">Sun</div>
              </div>
              <div class="calendar-days" id="calendarDays"></div>
            </div>
          </div>
        </div>

        <div class="chart-cluster">
          <div class="chart-cluster-header">
            <div class="chart-cluster-title">Strategy Breakdown</div>
            <div class="chart-cluster-sub">
              Profitability, short-side and long-side performance in a single, compact view.
            </div>
          </div>
          <div class="chart-cluster-grid">
            <div class="chart-card">
              <div class="chart-title" data-i18n="chartProfitabilityTitle">Profitability</div>
              <div class="chart-sub" data-i18n="chartProfitabilitySub">Win rate vs loss rate.</div>
              <div class="chart-wrapper">
                <canvas id="profitabilityChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-title" data-i18n="chartShortTitle">Short Analysis</div>
              <div class="chart-sub" data-i18n="chartShortSub">Profits, wins, and losses on short positions.</div>
              <div class="chart-wrapper">
                <canvas id="shortChart"></canvas>
              </div>
            </div>

            <div class="chart-card">
              <div class="chart-title" data-i18n="chartLongTitle">Long Analysis</div>
              <div class="chart-sub" data-i18n="chartLongSub">Profits, wins, and losses on long positions.</div>
              <div class="chart-wrapper">
                <canvas id="longChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="history-shell">
          <div class="history-head">
            <div class="history-title" data-i18n="tradeHistory">Trade History</div>
            <div class="history-meta" data-i18n="historyMeta">Scrollable table — real data from your account.</div>
          </div>
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th data-i18n="thShare">Share</th>
                  <th data-i18n="thSymbol">Symbol</th>
                  <th data-i18n="thType">Type</th>
                  <th data-i18n="thOpenDate">Open Date</th>
                  <th data-i18n="thOpen">Open</th>
                  <th data-i18n="thCloseDate">Closed Date</th>
                  <th data-i18n="thClose">Close</th>
                  <th data-i18n="thTp">TP</th>
                  <th data-i18n="thSl">SL</th>
                  <th data-i18n="thPnl">PnL</th>
                </tr>
              </thead>
              <tbody id="tradeBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== FOOTER COMPONENT ===== -->
    <div id="ml-footer"></div>
  </main>

  <button id="chatFab" class="chat-fab" aria-label="Open chat" aria-controls="chatPanel">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"
         stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M20 3H4a2 2 0 0 0-2 2v12l4-4h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z" />
      <circle cx="9" cy="10" r="1.25" />
      <circle cx="12" cy="10" r="1.25" />
      <circle cx="15" cy="10" r="1.25" />
    </svg>
  </button>

  <div id="chatPanel" class="chat-panel" role="dialog" aria-label="Assistant chat"
       aria-modal="true" aria-hidden="true">
    <div class="chat-header">
      <div class="chat-title">Assistant</div>
      <button id="chatClose" class="chat-close" aria-label="Close chat">×</button>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="chat-msg bot">Hi! How can I help?</div>
    </div>
    <form id="chatForm" class="chat-input-row">
      <input id="chatInput" type="text" placeholder="Type a message…" autocomplete="off" />
      <button class="chat-send" type="submit">Send</button>
    </form>
  </div>

  <script>
    // Load navbar and footer components with active state
    document.addEventListener('DOMContentLoaded', function() {
      // Load navbar
      fetch('./components/navbar.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('ml-navbar').innerHTML = data;
          // Highlight active menu item for Performance
          const performanceLink = document.querySelector('a[href*="performance.html"]');
          if (performanceLink) {
            const li = performanceLink.closest('li');
            if (li) {
              li.classList.add('active');
            }
          }
        })
        .catch(err => console.error('Error loading navbar:', err));

      // Load footer
      fetch('./components/footer.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('ml-footer').innerHTML = data;
        })
        .catch(err => console.error('Error loading footer:', err));
    });
  </script>

  <script>
    // Localization and UI management (updated for components)
    document.addEventListener('DOMContentLoaded', function () {
      const params = new URLSearchParams(window.location.search);
      let currentLang = params.get('lang') || 'en';

      const translations = {
        en: {
          accounts: "Accounts",
          paymentsWallet: "Payments & Wallet",
          subscription: "Subscription Plan",
          transactionHistory: "Transaction History",
          insight: "Insight",
          performance: "Performance",
          chart: "Chart",
          settings: "Settings",
          instructions: "Instructions",
          last30Days: "Last 30 Days",
          kpiSection: "Key Performance Indicators",
          kpiTradingDays: "Trading Days",
          kpiTotalTrades: "Total Trades Taken",
          kpiTotalLots: "Total Lots Used",
          kpiBiggestWin: "Biggest Win",
          kpiBiggestLoss: "Biggest Loss",
          kpiUpdatedDaily: "Updated daily.",
          kpiAllClosed: "All closed positions.",
          kpiCombinedExposure: "Combined exposure across trades.",
          kpiBestTrade: "Single best trade in the period.",
          kpiLargestDrawdown: "Largest drawdown on a trade.",
          weeklySummary: "Weekly Summary",
          dailyPnlCalendar: "Daily PnL Calendar",
          legendGreen: "Green = profit",
          legendRed: "Red = loss",
          legendNone: "No trades",
          mon: "Mon", tue: "Tue", wed: "Wed", thu: "Thu", fri: "Fri", sat: "Sat", sun: "Sun",
          chartProfitabilityTitle: "Profitability",
          chartProfitabilitySub: "Win rate vs loss rate.",
          chartShortTitle: "Short Analysis",
          chartShortSub: "Profits, wins, and losses on short positions.",
          chartLongTitle: "Long Analysis",
          chartLongSub: "Profits, wins, and losses on long positions.",
          tradeHistory: "Trade History",
          historyMeta: "Scrollable table — real data from your account.",
          thShare: "Share", thSymbol: "Symbol", thType: "Type", thOpenDate: "Open Date", thOpen: "Open",
          thCloseDate: "Closed Date", thClose: "Close", thTp: "TP", thSl: "SL", thPnl: "PnL"
        },
        de: {
          accounts: "Konten",
          paymentsWallet: "Zahlungen & Wallet",
          subscription: "Abonnementplan",
          transactionHistory: "Transaktionsverlauf",
          insight: "Einblicke",
          performance: "Leistung",
          chart: "Diagramm",
          settings: "Einstellungen",
          instructions: "Anleitung",
          last30Days: "Letzte 30 Tage",
          kpiSection: "Wichtige Leistungskennzahlen",
          kpiTradingDays: "Handelstage",
          kpiTotalTrades: "Gesamtanzahl Trades",
          kpiTotalLots: "Gesamt-Lots",
          kpiBiggestWin: "Größter Gewinn",
          kpiBiggestLoss: "Größter Verlust",
          kpiUpdatedDaily: "Täglich aktualisiert.",
          kpiAllClosed: "Alle geschlossenen Positionen.",
          kpiCombinedExposure: "Gesamtexponierung über alle Trades.",
          kpiBestTrade: "Bester Einzeltrade im Zeitraum.",
          kpiLargestDrawdown: "Größter Verlust eines Trades.",
          weeklySummary: "Wöchentliche Übersicht",
          dailyPnlCalendar: "Täglicher PnL-Kalender",
          legendGreen: "Grün = Gewinn",
          legendRed: "Rot = Verlust",
          legendNone: "Keine Trades",
          mon: "Mo", tue: "Di", wed: "Mi", thu: "Do", fri: "Fr", sat: "Sa", sun: "So",
          chartProfitabilityTitle: "Profitabilität",
          chartProfitabilitySub: "Trefferquote vs. Verlustquote.",
          chartShortTitle: "Short-Analyse",
          chartShortSub: "Gewinne, Treffer und Verluste bei Short-Positionen.",
          chartLongTitle: "Long-Analyse",
          chartLongSub: "Gewinne, Treffer und Verluste bei Long-Positionen.",
          tradeHistory: "Trade-Historie",
          historyMeta: "Scrollbare Tabelle – aktuelle Kontodaten.",
          thShare: "Teilen", thSymbol: "Symbol", thType: "Art", thOpenDate: "Eröffnungsdatum", thOpen: "Eröffnung",
          thCloseDate: "Schlussdatum", thClose: "Schluss", thTp: "TP", thSl: "SL", thPnl: "PnL"
        },
        es: {
          accounts: "Cuentas",
          paymentsWallet: "Pagos & Cartera",
          subscription: "Plan de suscripción",
          transactionHistory: "Historial de transacciones",
          insight: "Perspectiva",
          performance: "Rendimiento",
          chart: "Gráfico",
          settings: "Configuración",
          instructions: "Instrucciones",
          last30Days: "Últimos 30 días",
          kpiSection: "Indicadores clave de rendimiento",
          kpiTradingDays: "Días operados",
          kpiTotalTrades: "Total de operaciones",
          kpiTotalLots: "Lotes totales",
          kpiBiggestWin: "Mayor ganancia",
          kpiBiggestLoss: "Mayor pérdida",
          kpiUpdatedDaily: "Actualizado diariamente.",
          kpiAllClosed: "Todas las posiciones cerradas.",
          kpiCombinedExposure: "Exposición combinada de todas las operaciones.",
          kpiBestTrade: "Mejor operación del período.",
          kpiLargestDrawdown: "Mayor pérdida en una operación.",
          weeklySummary: "Resumen semanal",
          dailyPnlCalendar: "Calendario diario de PnL",
          legendGreen: "Verde = beneficio",
          legendRed: "Rojo = pérdida",
          legendNone: "Sin operaciones",
          mon: "Lun", tue: "Mar", wed: "Mié", thu: "Jue", fri: "Vie", sat: "Sáb", sun: "Dom",
          chartProfitabilityTitle: "Rentabilidad",
          chartProfitabilitySub: "Tasa de aciertos vs pérdidas.",
          chartShortTitle: "Análisis de cortos",
          chartShortSub: "Beneficios, aciertos y pérdidas en posiciones cortas.",
          chartLongTitle: "Análisis de largos",
          chartLongSub: "Beneficios, aciertos y pérdidas en posiciones largas.",
          tradeHistory: "Historial de operaciones",
          historyMeta: "Tabla desplazable — datos reales de tu cuenta.",
          thShare: "Compartir", thSymbol: "Símbolo", thType: "Tipo", thOpenDate: "Fecha de apertura", thOpen: "Apertura",
          thCloseDate: "Fecha de cierre", thClose: "Cierre", thTp: "TP", thSl: "SL", thPnl: "PnL"
        },
        fr: {
          accounts: "Comptes",
          paymentsWallet: "Paiements & Portefeuille",
          subscription: "Plan d'abonnement",
          transactionHistory: "Historique des transactions",
          insight: "Aperçu",
          performance: "Performance",
          chart: "Graphique",
          settings: "Paramètres",
          instructions: "Instructions",
          last30Days: "30 derniers jours",
          kpiSection: "Indicateurs clés de performance",
          kpiTradingDays: "Jours de trading",
          kpiTotalTrades: "Nombre total de trades",
          kpiTotalLots: "Lots totaux",
          kpiBiggestWin: "Plus gros gain",
          kpiBiggestLoss: "Plus grosse perte",
          kpiUpdatedDaily: "Mis à jour quotidiennement.",
          kpiAllClosed: "Toutes les positions clôturées.",
          kpiCombinedExposure: "Exposition totale sur l'ensemble des trades.",
          kpiBestTrade: "Meilleur trade de la période.",
          kpiLargestDrawdown: "Plus forte perte sur un trade.",
          weeklySummary: "Résumé hebdomadaire",
          dailyPnlCalendar: "Calendrier quotidien du PnL",
          legendGreen: "Vert = profit",
          legendRed: "Rouge = perte",
          legendNone: "Aucun trade",
          mon: "Lun", tue: "Mar", wed: "Mer", thu: "Jeu", fri: "Ven", sat: "Sam", sun: "Dim",
          chartProfitabilityTitle: "Rentabilité",
          chartProfitabilitySub: "Taux de gains vs pertes.",
          chartShortTitle: "Analyse des ventes",
          chartShortSub: "Profits, gains et pertes sur les positions vendeuses.",
          chartLongTitle: "Analyse des achats",
          chartLongSub: "Profits, gains et pertes sur les positions acheteuses.",
          tradeHistory: "Historique des trades",
          historyMeta: "Tableau défilant — données réelles de votre compte.",
          thShare: "Partager", thSymbol: "Symbole", thType: "Type", thOpenDate: "Date d'ouverture", thOpen: "Ouverture",
          thCloseDate: "Date de clôture", thClose: "Clôture", thTp: "TP", thSl: "SL", thPnl: "PnL"
        },
        ar: {
          accounts: "الحسابات",
          paymentsWallet: "المدفوعات والمحفظة",
          subscription: "خطة الاشتراك",
          transactionHistory: "سجل المعاملات",
          insight: "الرؤى",
          performance: "الأداء",
          chart: "الرسم البياني",
          settings: "الإعدادات",
          instructions: "التعليمات",
          last30Days: "آخر 30 يومًا",
          kpiSection: "مؤشرات الأداء الرئيسية",
          kpiTradingDays: "أيام التداول",
          kpiTotalTrades: "إجمالي الصفقات",
          kpiTotalLots: "إجمالي اللوتات",
          kpiBiggestWin: "أكبر صفقة رابحة",
          kpiBiggestLoss: "أكبر صفقة خاسرة",
          kpiUpdatedDaily: "يتم التحديث يوميًا.",
          kpiAllClosed: "جميع المراكز المغلقة.",
          kpiCombinedExposure: "إجمالي التعرّض عبر جميع الصفقات.",
          kpiBestTrade: "أفضل صفقة خلال الفترة.",
          kpiLargestDrawdown: "أكبر تراجع في صفقة واحدة.",
          weeklySummary: "الملخص الأسبوعي",
          dailyPnlCalendar: "تقويم الأرباح والخسائر اليومي",
          legendGreen: "الأخضر = ربح",
          legendRed: "الأحمر = خسارة",
          legendNone: "لا توجد صفقات",
          mon: "الاثنين", tue: "الثلاثاء", wed: "الأربعاء", thu: "الخميس", fri: "الجمعة", sat: "السبت", sun: "الأحد",
          chartProfitabilityTitle: "الربحية",
          chartProfitabilitySub: "نسبة الصفقات الرابحة مقابل الخاسرة.",
          chartShortTitle: "تحليل صفقات البيع",
          chartShortSub: "الأرباح، والصفقات الرابحة، والخاسرة في صفقات البيع.",
          chartLongTitle: "تحليل صفقات الشراء",
          chartLongSub: "الأرباح، والصفقات الرابحة، والخاسرة في صفقات الشراء.",
          tradeHistory: "سجل الصفقات",
          historyMeta: "جدول قابل للتمرير — بيانات حقيقية من حسابك.",
          thShare: "مشاركة", thSymbol: "الرمز", thType: "النوع", thOpenDate: "تاريخ الفتح", thOpen: "سعر الفتح",
          thCloseDate: "تاريخ الإغلاق", thClose: "سعر الإغلاق", thTp: "جني الربح", thSl: "إيقاف الخسارة", thPnl: "الربح/الخسارة"
        }
      };

      if (!translations[currentLang]) currentLang = 'en';

      function updateLinksWithLang() {
        const links = document.querySelectorAll('a[href]');
        links.forEach(a => {
          const href = a.getAttribute('href');
          if (!href || href.startsWith('#') || href.startsWith('http') || href.startsWith('mailto:') || href.startsWith('tel:')) return;
          try {
            const url = new URL(href, window.location.href);
            url.searchParams.set('lang', currentLang);
            a.setAttribute('href', url.pathname + '?' + url.searchParams.toString());
          } catch (_) {}
        });
      }

      function applyLanguage(lang) {
        const t = translations[lang] || translations.en;

        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if (!t[key]) return;

          if (el.querySelector('.legend-dot')) {
            const dot = el.querySelector('.legend-dot');
            const text = t[key].replace(/^[^=]*=\s*/, '');
            el.innerHTML = '';
            el.appendChild(dot);
            el.appendChild(document.createTextNode(text));
          } else {
            el.textContent = t[key];
          }
        });

        document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
        updateLinksWithLang();
      }

      const calendarLabel = document.getElementById('calendarLabel');
      const calendarDays = document.getElementById('calendarDays');
      const monthSelect = document.getElementById('monthSelect');
      const yearSelect = document.getElementById('yearSelect');
      const prevMonthBtn = document.getElementById('prevMonthBtn');
      const nextMonthBtn = document.getElementById('nextMonthBtn');

      const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
      let current = new Date();
      current.setDate(1);

      if (monthSelect) {
        monthSelect.innerHTML = '';
        monthNames.forEach((m, idx) => {
          const opt = document.createElement('option');
          opt.value = idx;
          opt.textContent = m;
          monthSelect.appendChild(opt);
        });
      }

      if (yearSelect) {
        yearSelect.innerHTML = '';
        const currentYear = new Date().getFullYear();
        for (let y = currentYear - 5; y <= currentYear + 5; y++) {
          const opt = document.createElement('option');
          opt.value = y;
          opt.textContent = y;
          yearSelect.appendChild(opt);
        }
      }

      function renderCalendar() {
        if (!calendarLabel || !calendarDays) return;
        
        const year = current.getFullYear();
        const month = current.getMonth();
        calendarLabel.textContent = `${monthNames[month]} ${year}`;
        if (monthSelect) monthSelect.value = month;
        if (yearSelect) yearSelect.value = year;

        calendarDays.innerHTML = '';

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const firstWeekday = (firstDay.getDay() + 6) % 7;
        const daysInMonth = lastDay.getDate();

        for (let i = 0; i < firstWeekday; i++) {
          const cell = document.createElement('div');
          cell.className = 'day-cell day-empty';
          calendarDays.appendChild(cell);
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const cell = document.createElement('div');
          cell.className = 'day-cell day-neutral';
          
          cell.innerHTML = `
            <div class="day-header">
              <span class="day-num">${d}</span>
              <span class="day-trades">No trades</span>
            </div>
            <div class="day-pnl"></div>
          `;
          calendarDays.appendChild(cell);
        }
      }

      if (monthSelect) {
        monthSelect.addEventListener('change', () => { 
          current.setMonth(parseInt(monthSelect.value, 10)); 
          renderCalendar(); 
        });
      }
      
      if (yearSelect) {
        yearSelect.addEventListener('change', () => { 
          current.setFullYear(parseInt(yearSelect.value, 10)); 
          renderCalendar(); 
        });
      }
      
      if (prevMonthBtn) {
        prevMonthBtn.addEventListener('click', () => { 
          current.setMonth(current.getMonth() - 1); 
          renderCalendar(); 
        });
      }
      
      if (nextMonthBtn) {
        nextMonthBtn.addEventListener('click', () => { 
          current.setMonth(current.getMonth() + 1); 
          renderCalendar(); 
        });
      }

      renderCalendar();
      applyLanguage(currentLang);
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const chatFab = document.getElementById('chatFab');
      const chatPanel = document.getElementById('chatPanel');
      const chatClose = document.getElementById('chatClose');
      const chatForm = document.getElementById('chatForm');
      const chatInput = document.getElementById('chatInput');
      const chatBody = document.getElementById('chatBody');

      function openChat() {
        chatPanel.classList.add('open');
        chatPanel.setAttribute('aria-hidden', 'false');
        if (chatInput) setTimeout(() => chatInput.focus(), 80);
      }
      function closeChat() {
        chatPanel.classList.remove('open');
        chatPanel.setAttribute('aria-hidden', 'true');
      }

      if (chatFab) {
        chatFab.addEventListener('click', function (e) {
          e.stopPropagation();
          chatPanel.classList.contains('open') ? closeChat() : openChat();
        });
      }

      if (chatClose) {
        chatClose.addEventListener('click', function (e) {
          e.stopPropagation();
          closeChat();
        });
      }

      document.addEventListener('click', function (e) {
        if (!chatPanel.classList.contains('open')) return;
        const target = e.target;
        if (chatPanel.contains(target) || chatFab.contains(target)) return;
        e.preventDefault();
        e.stopPropagation();
        closeChat();
      }, true);

      if (chatForm && chatInput && chatBody) {
        chatForm.addEventListener('submit', function (e) {
          e.preventDefault();
          const text = chatInput.value.trim();
          if (!text) return;
          const msg = document.createElement('div');
          msg.className = 'chat-msg user';
          msg.textContent = text;
          chatBody.appendChild(msg);
          chatInput.value = '';
          chatBody.scrollTop = chatBody.scrollHeight;
        });
      }
    });
  </script>

  <!-- ===== REQUIRED SCRIPTS (IN ORDER) ===== -->
  <script src="../scripts/auth.js"></script>
  <script src="./components/navbar.js"></script>
  <script src="../scripts/performance.js"></script>
  <script>
    // Footer fetch script
    document.addEventListener('DOMContentLoaded', function() {
      // Already loaded above in the initial component loading script
    });
  </script>
</body>
</html>